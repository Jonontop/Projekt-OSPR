<!DOCTYPE html>
<html lang="sl">
<head>
    <meta charset="UTF-8">
    <title>File Explorer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>File Explorer</h1>

    <!-- Drag & Drop obmoƒçje -->
    <div id="dropzone" class="dropzone">
        Povleci in spusti datoteko sem ali klikni spodnji gumb.
        <form action="/upload" method="post" enctype="multipart/form-data" id="uploadForm">
            <input type="file" name="file" id="fileInput" hidden onchange="document.getElementById('uploadForm').submit()">
            <button type="button" onclick="document.getElementById('fileInput').click()">üì§ Nalo≈æi datoteko</button>
        </form>
    </div>

    <!-- Obrazec za ustvarjanje nove mape -->
    <form action="/create_folder" method="post" class="folder-form">
        <input type="text" name="folder_name" placeholder="Ime nove mape" required>
        <button type="submit">üìÅ Ustvari mapo</button>
    </form>

    <h2>Vsebina</h2>
    {% if files %}
    <table class="file-table">
        <thead>
            <tr>
                <th>Ime</th>
                <th>Tip</th>
                <th>Velikost</th>
                <th>Povezava</th>
            </tr>
        </thead>
        <tbody>
            {% for file in files %}
            <tr>
                <td>
                    {% if file.type == 'Mapa' %}
                        üìÅ {{ file.name }}
                    {% else %}
                        üìÑ {{ file.name }}
                    {% endif %}
                </td>
                <td>{{ file.type }}</td>
                <td>{{ file.size }}{% if file.size != '-' %} KB{% endif %}</td>
                <td>
                    {% if file.type == 'Datoteka' %}
                        <a href="{{ url_for('uploaded_file', filename=file.name) }}" target="_blank">Odpri</a>
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Ni ≈°e vsebine.</p>
    {% endif %}

    <script>
        const dropzone = document.getElementById('dropzone');
        const fileInput = document.getElementById('fileInput');

        dropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropzone.classList.add('dragover');
        });

        dropzone.addEventListener('dragleave', () => {
            dropzone.classList.remove('dragover');
        });

        dropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropzone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const formData = new FormData();
                formData.append('file', files[0]);

                fetch('/upload', {
                    method: 'POST',
                    body: formData
                }).then(() => {
                    window.location.reload();
                });
            }
        });
    </script>
</body>
</html>

