{% extends "cpanel/server/base.html" %}

{% block title %}
  Console Logs
{% endblock %}

<script>
            // Function to update stats every 1 second
            function updateStats() {
                const containerId = '{{ server.container_id }}';  // Replace with actual container ID
                fetch(`/container_stats/${containerId}`)
                    .then(response => response.json())
                    .then(data => {
                        // Update CPU usage progress bar
                        const cpuPercentage = Math.min(data.cpu_percentage, 100); // Limit to 100% for display
                        document.getElementById("cpu_usage_bar").style.width = cpuPercentage + "%";
                        document.getElementById("cpu_usage_text").innerText = cpuPercentage.toFixed(2) + "%";
                        console.log("CPU Usage: " + cpuPercentage.toFixed(2) + "%");

                        // Update RAM usage progress bar
                        const memPercentage = Math.min(data.mem_percentage, 100); // Limit to 100% for display
                        document.getElementById("mem_usage_bar").style.width = memPercentage + "%";
                        document.getElementById("mem_usage_text").innerText = "Memory Usage: " + memPercentage.toFixed(2) + "%";
                        console.log("Memory Usage: " + memPercentage.toFixed(2) + "%");

                        // Update Disk usage progress bar
                        const diskPercentage = Math.min(data.disk_percentage, 100); // Limit to 100% for display
                        document.getElementById("disk_usage_bar").style.width = diskPercentage + "%";
                        document.getElementById("disk_usage_text").innerText = "Disk Usage: " + diskPercentage.toFixed(2) + "%";
                        console.log("Disk Usage: " + diskPercentage.toFixed(2) + "%");
                    })
                    .catch(error => console.error('Error fetching container stats:', error));
            }

            // Update stats every 1 second
            setInterval(updateStats, 1000);
        </script>

{% block content %}
<body>
    <style>
        #console {
            font-family: monospace;
            color: white;
            width: 90%;
            height: 60vh;
            overflow-y: auto;
            white-space: pre-wrap;
            border: 1px solid black;
            padding: 10px;
            background-color: black;

        }

            * {
      box-sizing: border-box;
    }
    body {
      font-family: sans-serif;
      background: #0f172a;
      color: white;
      display: flex;
      height: 100vh;
    }
    .left-panel {
      flex: 2;
      background: #0f172a;
      padding: 1rem;
      overflow-y: auto;
    }
    .right-panel {
      flex: 1;
      background: #1e293b;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    h1 {
      margin: 0;
      font-size: 1.5rem;
      color: #38bdf8;
    }
    .subtext {
      color: #facc15;
      font-size: 0.875rem;
      margin-bottom: 1rem;
    }
    .log-box {
      background: black;
      font-family: monospace;
      font-size: 0.75rem;
      padding: 0.5rem;
      border-radius: 5px;
      white-space: pre-wrap;
      overflow-x: auto;
      height: 100%;
    }
    .button-bar {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .button-bar button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .start { background: #22c55e; }
    .restart { background: #facc15; }
    .stop { background: #ef4444; }
    .kill { background: #f43f5e; }
    .info-box {
      background: #0f172a;
      border: 1px solid #334155;
      padding: 0.75rem;
      border-radius: 8px;
    }
    .info-label {
      font-size: 0.875rem;
      color: #94a3b8;
    }
    .info-value {
      font-size: 1rem;
      color: #e2e8f0;
    }
    .save-button, .renew-link {
      background: #0ea5e9;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      cursor: pointer;
      color: white;
      font-weight: bold;
    }
    .renew-link {
      background: none;
      color: #38bdf8;
      text-decoration: underline;
      padding: 0;
      margin-left: 0.5rem;
    }
    </style>
    <script>
        const containerId = "{{ container_id }}"; // Container ID from docker

        function startStream() {
            const eventSource = new EventSource(`/stream/${containerId}`);
            const consoleDiv = document.getElementById("console");

            eventSource.onmessage = function(event) {
                const newLine = document.createElement("div");
                newLine.textContent = event.data;
                consoleDiv.appendChild(newLine);
                consoleDiv.scrollTop = consoleDiv.scrollHeight; // Auto-scroll
            };

            eventSource.onerror = function() {
                consoleDiv.innerHTML += "\n[ERROR] Connection lost.";
                eventSource.close();
            };
        }

        window.onload = startStream;
    </script>
      <div class="left-panel">
        <div id="console"></div>
      </div>
      <div class="right-panel">
        <div class="button-bar">
          <a class="start" href="{{ url_for('start_server', container_id=container_id) }}"><button>Start</button></a>
          <a class="restart" href="{{ url_for('restart_server', container_id=container_id) }}"><button>Restart</button></a>
          <a class="stop" href="{{ url_for('stop_server', container_id=container_id) }}"><button>Stop</button></a>
          <a class="kill" href="{{ url_for('stop_server', container_id=container_id) }}"><button>Kill</button></a>
        </div>

        <div class="info-box">
          <div class="info-label">Uptime</div>
          <div class="info-value">38d 22h 42m 42s</div>
        </div>
        <div class="info-box">
          <div class="info-label">Address</div>
          <div class="info-value">45.134.39.193:6001</div>
        </div>
        <div class="info-box">
          <div class="info-label">CPU</div>
          <div class="info-value">0.00% / 100%</div>
        </div>
        <div class="info-box">
          <div class="info-label">Memory</div>
          <div class="info-value">14.6 MiB / 512 MiB</div>
        </div>
        <div class="info-box">
          <div class="info-label">Disk</div>
          <div class="info-value">1.56 MiB / 1 GiB</div>
        </div>
        <div class="info-box">
          <div class="info-label">Save Console Logs</div>
          <button class="save-button">Save</button>
        </div>
        <div class="info-box">
          <div class="info-label">Renewal Date</div>
          <div class="info-value">in 6 days <button class="renew-link">Renew</button></div>
        </div>
      </div>
</body>

{% endblock %}

