{% extends "cpanel/server/base.html" %}

{% block title %}
  System Settings
{% endblock %}

{% block content %}


<body>
    <div class="container mx-auto py-8 px-4">
        <div class="bg-white shadow-md rounded-lg max-w-4xl mx-auto p-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">Discord Webhook Settings</h1>

            <form action="/configure_webhook" method="POST" class="space-y-8">
                <!-- Webhook Configuration Section -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Webhook Configuration</h2>

                    <div class="space-y-4">
                        <div>
                            <label for="webhook_url" class="block text-sm font-medium text-gray-700 mb-1">Webhook URL</label>
                            <input type="text" id="webhook_url" name="webhook_url" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50" placeholder="https://discord.com/api/webhooks/...">
                            <p class="mt-1 text-sm text-gray-500">Enter the webhook URL from your Discord server settings</p>
                        </div>

                        <div>
                            <label for="webhook_name" class="block text-sm font-medium text-gray-700 mb-1">Webhook Name</label>
                            <input type="text" id="webhook_name" name="webhook_name" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter webhook name">
                        </div>
                    </div>
                </div>

                <!-- Message Configuration -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Message Settings</h2>

                    <div class="space-y-6">
                        <!-- Message Avatar -->
                        <div>
                            <label for="avatar_url" class="block text-sm font-medium text-gray-700 mb-1">Avatar URL (Optional)</label>
                            <input type="text" id="avatar_url" name="avatar_url" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://example.com/avatar.png">
                        </div>

                        <!-- Message Color -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Embed Color</label>
                            <div class="flex items-center">
                                <button type="button" class="color-prev px-3 py-2 bg-gray-200 text-gray-700 rounded-l-md hover:bg-gray-300" onclick="prevColor()">-</button>
                                <div id="color-display" class="w-24 h-10 border-t border-b border-gray-300 bg-blue-500"></div>
                                <button type="button" class="color-next px-3 py-2 bg-gray-200 text-gray-700 rounded-r-md hover:bg-gray-300" onclick="nextColor()">+</button>
                                <input type="hidden" id="embed_color" name="embed_color" value="#3b82f6">
                                <span id="color-name" class="ml-3 text-gray-600">Blue</span>
                            </div>
                        </div>

                        <!-- Notification Type -->
                        <div>
                            <label for="notification_type" class="block text-sm font-medium text-gray-700 mb-1">Notification Type</label>
                            <select id="notification_type" name="notification_type" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">All Messages</option>
                                <option value="alerts">Alerts Only</option>
                                <option value="errors">Errors Only</option>
                                <option value="status">Status Updates</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Ping Settings -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Ping Settings</h2>

                    <div class="space-y-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="ping_everyone" name="ping_everyone" class="h-4 w-4 text-blue-500 focus:ring-blue-400 border-gray-300 rounded">
                            <label for="ping_everyone" class="ml-2 block text-sm text-gray-700">Ping @everyone for critical alerts</label>
                        </div>

                        <div>
                            <label for="role_id" class="block text-sm font-medium text-gray-700 mb-1">Role ID to Ping (Optional)</label>
                            <input type="text" id="role_id" name="role_id" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter Discord role ID">
                        </div>
                    </div>
                </div>

                <!-- Test Connection -->
                <div class="border-b pb-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Test Webhook</h2>

                    <div class="space-y-4">
                        <div>
                            <label for="test_message" class="block text-sm font-medium text-gray-700 mb-1">Test Message</label>
                            <textarea id="test_message" name="test_message" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter a test message to send to the webhook">This is a test message from the webhook configuration.</textarea>
                        </div>

                        <div>
                            <button type="button" id="test_button" class="px-4 py-2 bg-gray-500 text-white font-medium rounded-md shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500" onclick="testWebhook()">
                                Test Webhook
                            </button>
                            <span id="test_status" class="ml-2 text-sm text-gray-500"></span>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="flex justify-end">
                    <button type="submit" class="px-6 py-2 bg-blue-500 text-white font-medium rounded-md shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        Save Webhook
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Color selection
        const colors = [
            { name: "Red", hex: "#ef4444", class: "bg-red-500" },
            { name: "Orange", hex: "#f97316", class: "bg-orange-500" },
            { name: "Amber", hex: "#f59e0b", class: "bg-amber-500" },
            { name: "Yellow", hex: "#eab308", class: "bg-yellow-500" },
            { name: "Green", hex: "#22c55e", class: "bg-green-500" },
            { name: "Teal", hex: "#14b8a6", class: "bg-teal-500" },
            { name: "Blue", hex: "#3b82f6", class: "bg-blue-500" },
            { name: "Indigo", hex: "#6366f1", class: "bg-indigo-500" },
            { name: "Purple", hex: "#a855f7", class: "bg-purple-500" },
            { name: "Pink", hex: "#ec4899", class: "bg-pink-500" }
        ];

        let currentColorIndex = 6; // Default blue

        function updateColorDisplay() {
            const colorDisplay = document.getElementById('color-display');
            const colorNameDisplay = document.getElementById('color-name');
            const embedColorInput = document.getElementById('embed_color');

            // Remove all background classes
            colors.forEach(color => {
                const className = color.class;
                if (colorDisplay.classList.contains(className.substring(3))) {
                    colorDisplay.classList.remove(className.substring(3));
                }
            });

            // Add current color class
            colorDisplay.style.backgroundColor = colors[currentColorIndex].hex;
            colorNameDisplay.textContent = colors[currentColorIndex].name;
            embedColorInput.value = colors[currentColorIndex].hex;
        }

        function nextColor() {
            currentColorIndex = (currentColorIndex + 1) % colors.length;
            updateColorDisplay();
        }

        function prevColor() {
            currentColorIndex = (currentColorIndex - 1 + colors.length) % colors.length;
            updateColorDisplay();
        }

        // Test webhook function
        function testWebhook() {
            const webhookUrl = document.getElementById('webhook_url').value;
            const testMessage = document.getElementById('test_message').value;
            const testStatus = document.getElementById('test_status');

            if (!webhookUrl) {
                testStatus.textContent = "Please enter a webhook URL first";
                testStatus.className = "ml-2 text-sm text-red-500";
                return;
            }

            testStatus.textContent = "Sending test message...";
            testStatus.className = "ml-2 text-sm text-gray-500";

            // In a real implementation, you would send an AJAX request to your backend
            // This is just a simulation for the UI
            setTimeout(() => {
                testStatus.textContent = "Test message sent successfully!";
                testStatus.className = "ml-2 text-sm text-green-500";
            }, 1500);
        }

        // Initialize the color selector
        document.addEventListener('DOMContentLoaded', function() {
            updateColorDisplay();
        });
    </script>
</body>

{% endblock %}